import E from"./RuleEngineItem.DN7OkPYW.2024-08-23_0855.js";import{s as T}from"./commonUtils.DH26LAgi.2024-08-23_0855.js";import{b as A}from"./bus.C7soAy4q.2024-08-23_0855.js";import{S as F}from"./@svgdotjs.ByEYl7u-.2024-08-23_0855.js";import{d as N,b as c,j as S,G as D,A as j,ai as i,o as v,c as G,U as t,O as r,S as y,u as l,M as h,R as C,a as I,D as M,F as O,n as z}from"./@vue.BRKSBXdb.2024-08-23_0855.js";import"./plugin-vueexport-helper.DlAUqK2U.2024-08-23_0855.js";import"./mitt.DJ65BbbF.2024-08-23_0855.js";const L={style:{"text-align":"center"}},Y=N({__name:"RuleEngine",setup($){const _=c(),s=c(!1),o=c({parent:"",condition:"or",left:"A",operator:"=",right:"B"}),u=c([]);let f;S(()=>{const n="svg-container";k(n),f=F().addTo("#"+n).size("100%","100%"),D("draw",f)}),j(()=>{f.clear()});function k(n){const e=document.getElementById(n);e&&document.body.removeChild(e);const d=document.createElement("div");d.id=n,document.body.appendChild(d)}function x(){s.value=!0}function b(){_.value.resetFields()}function w(n){n.validate(async e=>{if(!e)return console.log("error submit!!"),!1;U(),b(),s.value=!1,await z(),requestAnimationFrame(()=>{f.clear(),A.emit("update-svg")})})}function U(){const n=new Date().getTime(),e={id:n,value:n};if(Object.assign(e,o.value),e.label=e.left+" "+e.operator+" "+e.right,u.value.length===0){u.value.push(e);return}const d=T(u.value,o.value.parent);d.children||(d.children=[]),d.children.push(e)}return(n,e)=>{const d=i("el-button"),B=i("el-tree-select"),m=i("el-form-item"),p=i("el-option"),V=i("el-select"),g=i("el-input"),q=i("el-form"),R=i("el-dialog");return v(),G(O,null,[t(d,{type:"primary",onClick:x,style:{"margin-bottom":"20px"}},{default:r(()=>[y("添加活动")]),_:1}),l(u).length>0?(v(),h(E,{key:0,data:l(u)[0]},null,8,["data"])):C("",!0),t(R,{modelValue:l(s),"onUpdate:modelValue":e[6]||(e[6]=a=>M(s)?s.value=a:null),title:"添加活动",width:"500",onClose:b},{default:r(()=>[t(q,{style:{"max-width":"600px"},ref_key:"formRef",ref:_,model:l(o),"label-width":"auto"},{default:r(()=>[l(u).length>0?(v(),h(m,{key:0,label:"父节点",prop:"parent",required:""},{default:r(()=>[t(B,{modelValue:l(o).parent,"onUpdate:modelValue":e[0]||(e[0]=a=>l(o).parent=a),data:l(u),"render-after-expand":!1,"check-strictly":!0},null,8,["modelValue","data"])]),_:1})):C("",!0),t(m,{label:"判断条件",prop:"condition",required:""},{default:r(()=>[t(V,{modelValue:l(o).condition,"onUpdate:modelValue":e[1]||(e[1]=a=>l(o).condition=a),placeholder:"请选择"},{default:r(()=>[t(p,{label:"或者",value:"or"}),t(p,{label:"并且",value:"and"})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"值1",prop:"left",required:""},{default:r(()=>[t(g,{modelValue:l(o).left,"onUpdate:modelValue":e[2]||(e[2]=a=>l(o).left=a)},null,8,["modelValue"])]),_:1}),t(m,{label:"比较条件",prop:"operator",required:""},{default:r(()=>[t(V,{modelValue:l(o).operator,"onUpdate:modelValue":e[3]||(e[3]=a=>l(o).operator=a),placeholder:"请选择"},{default:r(()=>[t(p,{label:"大于",value:">"}),t(p,{label:"等于",value:"="}),t(p,{label:"小于",value:"<"})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"值2",prop:"right",required:""},{default:r(()=>[t(g,{modelValue:l(o).right,"onUpdate:modelValue":e[4]||(e[4]=a=>l(o).right=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),I("div",L,[t(d,{type:"primary",onClick:e[5]||(e[5]=a=>w(l(_)))},{default:r(()=>[y("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}});export{Y as default};
