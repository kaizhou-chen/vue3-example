import{s as te}from"./vue-resize.BbUHgDXa.2024-08-23_0855.js";import{O as ie}from"./vue-observe-visibility.ESr3qVA-.2024-08-23_0855.js";import{an as se,aw as re,ah as le,ai as Y,aq as ne,P as oe,o as w,c as k,H as b,R as q,M as F,O as I,F as ae,a8 as ce,Q as W,K as X,am as de,J as he,I as K,U as ue,ac as fe,ad as me}from"./@vue.BRKSBXdb.2024-08-23_0855.js";function pe(e){return{all:e=e||new Map,on:function(t,i){var s=e.get(t);s&&s.push(i)||e.set(t,[i])},off:function(t,i){var s=e.get(t);s&&s.splice(s.indexOf(i)>>>0,1)},emit:function(t,i){(e.get(t)||[]).slice().map(function(s){s(i)}),(e.get("*")||[]).slice().map(function(s){s(t,i)})}}}var G={itemsLimit:1e3},ve=/(auto|scroll)/;function J(e,t){return e.parentNode===null?t:J(e.parentNode,t.concat([e]))}var A=function(t,i){return getComputedStyle(t,null).getPropertyValue(i)},ye=function(t){return A(t,"overflow")+A(t,"overflow-y")+A(t,"overflow-x")},ze=function(t){return ve.test(ye(t))};function j(e){if(e instanceof HTMLElement||e instanceof SVGElement){for(var t=J(e.parentNode,[]),i=0;i<t.length;i+=1)if(ze(t[i]))return t[i];return document.scrollingElement||document.documentElement}}function x(e){"@babel/helpers - typeof";return x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(e)}var Q={items:{type:Array,required:!0},keyField:{type:String,default:"id"},direction:{type:String,default:"vertical",validator:function(t){return["vertical","horizontal"].includes(t)}},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"}};function Z(){return this.items.length&&x(this.items[0])!=="object"}var L=!1;if(typeof window<"u"){L=!1;try{var ge=Object.defineProperty({},"passive",{get:function(){L=!0}});window.addEventListener("test",null,ge)}catch{}}let Se=0;var R={name:"RecycleScroller",components:{ResizeObserver:te},directives:{ObserveVisibility:ie},props:{...Q,itemSize:{type:Number,default:null},gridItems:{type:Number,default:void 0},itemSecondarySize:{type:Number,default:void 0},minItemSize:{type:[Number,String],default:null},sizeField:{type:String,default:"size"},typeField:{type:String,default:"type"},buffer:{type:Number,default:200},pageMode:{type:Boolean,default:!1},prerender:{type:Number,default:0},emitUpdate:{type:Boolean,default:!1},updateInterval:{type:Number,default:0},skipHover:{type:Boolean,default:!1},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},listClass:{type:[String,Object,Array],default:""},itemClass:{type:[String,Object,Array],default:""}},emits:["resize","visible","hidden","update","scroll-start","scroll-end"],data(){return{pool:[],totalSize:0,ready:!1,hoverKey:null}},computed:{sizes(){if(this.itemSize===null){const e={"-1":{accumulator:0}},t=this.items,i=this.sizeField,s=this.minItemSize;let r=1e4,c=0,l;for(let a=0,d=t.length;a<d;a++)l=t[a][i]||s,l<r&&(r=l),c+=l,e[a]={accumulator:c,size:l};return this.$_computedMinItemSize=r,e}return[]},simpleArray:Z,itemIndexByKey(){const{keyField:e,items:t}=this,i={};for(let s=0,r=t.length;s<r;s++)i[t[s][e]]=s;return i}},watch:{items(){this.updateVisibleItems(!0)},pageMode(){this.applyPageMode(),this.updateVisibleItems(!1)},sizes:{handler(){this.updateVisibleItems(!1)},deep:!0},gridItems(){this.updateVisibleItems(!0)},itemSecondarySize(){this.updateVisibleItems(!0)}},created(){this.$_startIndex=0,this.$_endIndex=0,this.$_views=new Map,this.$_unusedViews=new Map,this.$_scrollDirty=!1,this.$_lastUpdateScrollPosition=0,this.prerender&&(this.$_prerender=!0,this.updateVisibleItems(!1)),this.gridItems&&!this.itemSize&&console.error("[vue-recycle-scroller] You must provide an itemSize when using gridItems")},mounted(){this.applyPageMode(),this.$nextTick(()=>{this.$_prerender=!1,this.updateVisibleItems(!0),this.ready=!0})},activated(){const e=this.$_lastUpdateScrollPosition;typeof e=="number"&&this.$nextTick(()=>{this.scrollToPosition(e)})},beforeUnmount(){this.removeListeners()},methods:{addView(e,t,i,s,r){const c=se({id:Se++,index:t,used:!0,key:s,type:r}),l=re({item:i,position:0,nr:c});return e.push(l),l},unuseView(e,t=!1){const i=this.$_unusedViews,s=e.nr.type;let r=i.get(s);r||(r=[],i.set(s,r)),r.push(e),t||(e.nr.used=!1,e.position=-9999)},handleResize(){this.$emit("resize"),this.ready&&this.updateVisibleItems(!1)},handleScroll(e){if(!this.$_scrollDirty){if(this.$_scrollDirty=!0,this.$_updateTimeout)return;const t=()=>requestAnimationFrame(()=>{this.$_scrollDirty=!1;const{continuous:i}=this.updateVisibleItems(!1,!0);i||(clearTimeout(this.$_refreshTimout),this.$_refreshTimout=setTimeout(this.handleScroll,this.updateInterval+100))});t(),this.updateInterval&&(this.$_updateTimeout=setTimeout(()=>{this.$_updateTimeout=0,this.$_scrollDirty&&t()},this.updateInterval))}},handleVisibilityChange(e,t){this.ready&&(e||t.boundingClientRect.width!==0||t.boundingClientRect.height!==0?(this.$emit("visible"),requestAnimationFrame(()=>{this.updateVisibleItems(!1)})):this.$emit("hidden"))},updateVisibleItems(e,t=!1){const i=this.itemSize,s=this.gridItems||1,r=this.itemSecondarySize||i,c=this.$_computedMinItemSize,l=this.typeField,a=this.simpleArray?null:this.keyField,d=this.items,h=d.length,S=this.sizes,U=this.$_views,C=this.$_unusedViews,V=this.pool,ee=this.itemIndexByKey;let p,u,T,z,g;if(!h)p=u=z=g=T=0;else if(this.$_prerender)p=z=0,u=g=Math.min(this.prerender,d.length),T=null;else{const n=this.getScroll();if(t){let m=n.start-this.$_lastUpdateScrollPosition;if(m<0&&(m=-m),i===null&&m<c||m<i)return{continuous:!0}}this.$_lastUpdateScrollPosition=n.start;const v=this.buffer;n.start-=v,n.end+=v;let f=0;if(this.$refs.before&&(f=this.$refs.before.scrollHeight,n.start-=f),this.$refs.after){const m=this.$refs.after.scrollHeight;n.end+=m}if(i===null){let m,D=0,H=h-1,y=~~(h/2),E;do E=y,m=S[y].accumulator,m<n.start?D=y:y<h-1&&S[y+1].accumulator>n.start&&(H=y),y=~~((D+H)/2);while(y!==E);for(y<0&&(y=0),p=y,T=S[h-1].accumulator,u=y;u<h&&S[u].accumulator<n.end;u++);for(u===-1?u=d.length-1:(u++,u>h&&(u=h)),z=p;z<h&&f+S[z].accumulator<n.start;z++);for(g=z;g<h&&f+S[g].accumulator<n.end;g++);}else{p=~~(n.start/i*s);const m=p%s;p-=m,u=Math.ceil(n.end/i*s),z=Math.max(0,Math.floor((n.start-f)/i*s)),g=Math.floor((n.end-f)/i*s),p<0&&(p=0),u>h&&(u=h),z<0&&(z=0),g>h&&(g=h),T=Math.ceil(h/s)*i}}u-p>G.itemsLimit&&this.itemsLimitError(),this.totalSize=T;let o;const P=p<=this.$_endIndex&&u>=this.$_startIndex;if(P)for(let n=0,v=V.length;n<v;n++)o=V[n],o.nr.used&&(e&&(o.nr.index=ee[o.item[a]]),(o.nr.index==null||o.nr.index<p||o.nr.index>=u)&&this.unuseView(o));const N=P?null:new Map;let _,$,M;for(let n=p;n<u;n++){_=d[n];const v=a?_[a]:_;if(v==null)throw new Error(`Key is ${v} on item (keyField is '${a}')`);if(o=U.get(v),!i&&!S[n].size){o&&this.unuseView(o);continue}$=_[l];let f=C.get($),m=!1;if(!o)P?f&&f.length?o=f.pop():o=this.addView(V,n,_,v,$):(M=N.get($)||0,(!f||M>=f.length)&&(o=this.addView(V,n,_,v,$),this.unuseView(o,!0),f=C.get($)),o=f[M],N.set($,M+1)),U.delete(o.nr.key),o.nr.used=!0,o.nr.index=n,o.nr.key=v,o.nr.type=$,U.set(v,o),m=!0;else if(!o.nr.used&&(o.nr.used=!0,m=!0,f)){const D=f.indexOf(o);D!==-1&&f.splice(D,1)}o.item=_,m&&(n===d.length-1&&this.$emit("scroll-end"),n===0&&this.$emit("scroll-start")),i===null?(o.position=S[n-1].accumulator,o.offset=0):(o.position=Math.floor(n/s)*i,o.offset=n%s*r)}return this.$_startIndex=p,this.$_endIndex=u,this.emitUpdate&&this.$emit("update",p,u,z,g),clearTimeout(this.$_sortTimer),this.$_sortTimer=setTimeout(this.sortViews,this.updateInterval+300),{continuous:P}},getListenerTarget(){let e=j(this.$el);return window.document&&(e===window.document.documentElement||e===window.document.body)&&(e=window),e},getScroll(){const{$el:e,direction:t}=this,i=t==="vertical";let s;if(this.pageMode){const r=e.getBoundingClientRect(),c=i?r.height:r.width;let l=-(i?r.top:r.left),a=i?window.innerHeight:window.innerWidth;l<0&&(a+=l,l=0),l+a>c&&(a=c-l),s={start:l,end:l+a}}else i?s={start:e.scrollTop,end:e.scrollTop+e.clientHeight}:s={start:e.scrollLeft,end:e.scrollLeft+e.clientWidth};return s},applyPageMode(){this.pageMode?this.addListeners():this.removeListeners()},addListeners(){this.listenerTarget=this.getListenerTarget(),this.listenerTarget.addEventListener("scroll",this.handleScroll,L?{passive:!0}:!1),this.listenerTarget.addEventListener("resize",this.handleResize)},removeListeners(){this.listenerTarget&&(this.listenerTarget.removeEventListener("scroll",this.handleScroll),this.listenerTarget.removeEventListener("resize",this.handleResize),this.listenerTarget=null)},scrollToItem(e){let t;const i=this.gridItems||1;this.itemSize===null?t=e>0?this.sizes[e-1].accumulator:0:t=Math.floor(e/i)*this.itemSize,this.scrollToPosition(t)},scrollToPosition(e){const t=this.direction==="vertical"?{scroll:"scrollTop",start:"top"}:{scroll:"scrollLeft",start:"left"};let i,s,r;if(this.pageMode){const c=j(this.$el),l=c.tagName==="HTML"?0:c[t.scroll],a=c.getBoundingClientRect(),h=this.$el.getBoundingClientRect()[t.start]-a[t.start];i=c,s=t.scroll,r=e+l+h}else i=this.$el,s=t.scroll,r=e;i[s]=r},itemsLimitError(){throw setTimeout(()=>{console.log("It seems the scroller element isn't scrolling, so it tries to render all the items at once.","Scroller:",this.$el),console.log("Make sure the scroller has a fixed height (or width) and 'overflow-y' (or 'overflow-x') set to 'auto' so it can scroll correctly and only render the items visible in the scroll viewport.")}),new Error("Rendered items limit reached")},sortViews(){this.pool.sort((e,t)=>e.nr.index-t.nr.index)}}};const $e={key:0,ref:"before",class:"vue-recycle-scroller__slot"},be={key:1,ref:"after",class:"vue-recycle-scroller__slot"};function _e(e,t,i,s,r,c){const l=Y("ResizeObserver"),a=ne("observe-visibility");return oe((w(),k("div",{class:K(["vue-recycle-scroller",{ready:r.ready,"page-mode":i.pageMode,[`direction-${e.direction}`]:!0}]),onScrollPassive:t[0]||(t[0]=(...d)=>c.handleScroll&&c.handleScroll(...d))},[e.$slots.before?(w(),k("div",$e,[b(e.$slots,"before")],512)):q("v-if",!0),(w(),F(W(i.listTag),{ref:"wrapper",style:he({[e.direction==="vertical"?"minHeight":"minWidth"]:r.totalSize+"px"}),class:K(["vue-recycle-scroller__item-wrapper",i.listClass])},{default:I(()=>[(w(!0),k(ae,null,ce(r.pool,d=>(w(),F(W(i.itemTag),X({key:d.nr.id,style:r.ready?{transform:`translate${e.direction==="vertical"?"Y":"X"}(${d.position}px) translate${e.direction==="vertical"?"X":"Y"}(${d.offset}px)`,width:i.gridItems?`${e.direction==="vertical"&&i.itemSecondarySize||i.itemSize}px`:void 0,height:i.gridItems?`${e.direction==="horizontal"&&i.itemSecondarySize||i.itemSize}px`:void 0}:null,class:["vue-recycle-scroller__item-view",[i.itemClass,{hover:!i.skipHover&&r.hoverKey===d.nr.key}]]},de(i.skipHover?{}:{mouseenter:()=>{r.hoverKey=d.nr.key},mouseleave:()=>{r.hoverKey=null}})),{default:I(()=>[b(e.$slots,"default",{item:d.item,index:d.nr.index,active:d.nr.used})]),_:2},1040,["style","class"]))),128)),b(e.$slots,"empty")]),_:3},8,["style","class"])),e.$slots.after?(w(),k("div",be,[b(e.$slots,"after")],512)):q("v-if",!0),ue(l,{onNotify:c.handleResize},null,8,["onNotify"])],34)),[[a,c.handleVisibilityChange]])}R.render=_e;R.__file="src/components/RecycleScroller.vue";var O={name:"DynamicScroller",components:{RecycleScroller:R},provide(){return typeof ResizeObserver<"u"&&(this.$_resizeObserver=new ResizeObserver(e=>{requestAnimationFrame(()=>{if(Array.isArray(e)){for(const t of e)if(t.target&&t.target.$_vs_onResize){let i,s;if(t.borderBoxSize){const r=t.borderBoxSize[0];i=r.inlineSize,s=r.blockSize}else i=t.contentRect.width,s=t.contentRect.height;t.target.$_vs_onResize(t.target.$_vs_id,i,s)}}})})),{vscrollData:this.vscrollData,vscrollParent:this,vscrollResizeObserver:this.$_resizeObserver}},inheritAttrs:!1,props:{...Q,minItemSize:{type:[Number,String],required:!0}},emits:["resize","visible"],data(){return{vscrollData:{active:!0,sizes:{},keyField:this.keyField,simpleArray:!1}}},computed:{simpleArray:Z,itemsWithSize(){const e=[],{items:t,keyField:i,simpleArray:s}=this,r=this.vscrollData.sizes,c=t.length;for(let l=0;l<c;l++){const a=t[l],d=s?l:a[i];let h=r[d];typeof h>"u"&&!this.$_undefinedMap[d]&&(h=0),e.push({item:a,id:d,size:h})}return e}},watch:{items(){this.forceUpdate()},simpleArray:{handler(e){this.vscrollData.simpleArray=e},immediate:!0},direction(e){this.forceUpdate(!0)},itemsWithSize(e,t){const i=this.$el.scrollTop;let s=0,r=0;const c=Math.min(e.length,t.length);for(let a=0;a<c&&!(s>=i);a++)s+=t[a].size||this.minItemSize,r+=e[a].size||this.minItemSize;const l=r-s;l!==0&&(this.$el.scrollTop+=l)}},beforeCreate(){this.$_updates=[],this.$_undefinedSizes=0,this.$_undefinedMap={},this.$_events=pe()},activated(){this.vscrollData.active=!0},deactivated(){this.vscrollData.active=!1},unmounted(){this.$_events.all.clear()},methods:{onScrollerResize(){this.$refs.scroller&&this.forceUpdate(),this.$emit("resize")},onScrollerVisible(){this.$_events.emit("vscroll:update",{force:!1}),this.$emit("visible")},forceUpdate(e=!1){(e||this.simpleArray)&&(this.vscrollData.sizes={}),this.$_events.emit("vscroll:update",{force:!0})},scrollToItem(e){const t=this.$refs.scroller;t&&t.scrollToItem(e)},getItemSize(e,t=void 0){const i=this.simpleArray?t??this.items.indexOf(e):e[this.keyField];return this.vscrollData.sizes[i]||0},scrollToBottom(){if(this.$_scrollingToBottom)return;this.$_scrollingToBottom=!0;const e=this.$el;this.$nextTick(()=>{e.scrollTop=e.scrollHeight+5e3;const t=()=>{e.scrollTop=e.scrollHeight+5e3,requestAnimationFrame(()=>{e.scrollTop=e.scrollHeight+5e3,this.$_undefinedSizes===0?this.$_scrollingToBottom=!1:requestAnimationFrame(t)})};requestAnimationFrame(t)})}}};function we(e,t,i,s,r,c){const l=Y("RecycleScroller");return w(),F(l,X({ref:"scroller",items:c.itemsWithSize,"min-item-size":i.minItemSize,direction:e.direction,"key-field":"id","list-tag":e.listTag,"item-tag":e.itemTag},e.$attrs,{onResize:c.onScrollerResize,onVisible:c.onScrollerVisible}),{default:I(({item:a,index:d,active:h})=>[b(e.$slots,"default",fe(me({item:a.item,index:d,active:h,itemWithSize:a})))]),before:I(()=>[b(e.$slots,"before")]),after:I(()=>[b(e.$slots,"after")]),empty:I(()=>[b(e.$slots,"empty")]),_:3},16,["items","min-item-size","direction","list-tag","item-tag","onResize","onVisible"])}O.render=we;O.__file="src/components/DynamicScroller.vue";var B={name:"DynamicScrollerItem",inject:["vscrollData","vscrollParent","vscrollResizeObserver"],props:{item:{required:!0},watchData:{type:Boolean,default:!1},active:{type:Boolean,required:!0},index:{type:Number,default:void 0},sizeDependencies:{type:[Array,Object],default:null},emitResize:{type:Boolean,default:!1},tag:{type:String,default:"div"}},emits:["resize"],computed:{id(){if(this.vscrollData.simpleArray)return this.index;if(this.vscrollData.keyField in this.item)return this.item[this.vscrollData.keyField];throw new Error(`keyField '${this.vscrollData.keyField}' not found in your item. You should set a valid keyField prop on your Scroller`)},size(){return this.vscrollData.sizes[this.id]||0},finalActive(){return this.active&&this.vscrollData.active}},watch:{watchData:"updateWatchData",id(e,t){if(this.$el.$_vs_id=this.id,this.size||this.onDataUpdate(),this.$_sizeObserved){const i=this.vscrollData.sizes[t],s=this.vscrollData.sizes[e];i!=null&&i!==s&&this.applySize(i)}},finalActive(e){this.size||(e?this.vscrollParent.$_undefinedMap[this.id]||(this.vscrollParent.$_undefinedSizes++,this.vscrollParent.$_undefinedMap[this.id]=!0):this.vscrollParent.$_undefinedMap[this.id]&&(this.vscrollParent.$_undefinedSizes--,this.vscrollParent.$_undefinedMap[this.id]=!1)),this.vscrollResizeObserver?e?this.observeSize():this.unobserveSize():e&&this.$_pendingVScrollUpdate===this.id&&this.updateSize()}},created(){if(!this.$isServer&&(this.$_forceNextVScrollUpdate=null,this.updateWatchData(),!this.vscrollResizeObserver)){for(const e in this.sizeDependencies)this.$watch(()=>this.sizeDependencies[e],this.onDataUpdate);this.vscrollParent.$_events.on("vscroll:update",this.onVscrollUpdate)}},mounted(){this.finalActive&&(this.updateSize(),this.observeSize())},beforeUnmount(){this.vscrollParent.$_events.off("vscroll:update",this.onVscrollUpdate),this.unobserveSize()},methods:{updateSize(){this.finalActive?this.$_pendingSizeUpdate!==this.id&&(this.$_pendingSizeUpdate=this.id,this.$_forceNextVScrollUpdate=null,this.$_pendingVScrollUpdate=null,this.computeSize(this.id)):this.$_forceNextVScrollUpdate=this.id},updateWatchData(){this.watchData&&!this.vscrollResizeObserver?this.$_watchData=this.$watch("item",()=>{this.onDataUpdate()},{deep:!0}):this.$_watchData&&(this.$_watchData(),this.$_watchData=null)},onVscrollUpdate({force:e}){!this.finalActive&&e&&(this.$_pendingVScrollUpdate=this.id),(this.$_forceNextVScrollUpdate===this.id||e||!this.size)&&this.updateSize()},onDataUpdate(){this.updateSize()},computeSize(e){this.$nextTick(()=>{if(this.id===e){const t=this.$el.offsetWidth,i=this.$el.offsetHeight;this.applyWidthHeight(t,i)}this.$_pendingSizeUpdate=null})},applyWidthHeight(e,t){const i=~~(this.vscrollParent.direction==="vertical"?t:e);i&&this.size!==i&&this.applySize(i)},applySize(e){this.vscrollParent.$_undefinedMap[this.id]&&(this.vscrollParent.$_undefinedSizes--,this.vscrollParent.$_undefinedMap[this.id]=void 0),this.vscrollData.sizes[this.id]=e,this.emitResize&&this.$emit("resize",this.id)},observeSize(){this.vscrollResizeObserver&&(this.$_sizeObserved||(this.vscrollResizeObserver.observe(this.$el),this.$el.$_vs_id=this.id,this.$el.$_vs_onResize=this.onResize,this.$_sizeObserved=!0))},unobserveSize(){this.vscrollResizeObserver&&this.$_sizeObserved&&(this.vscrollResizeObserver.unobserve(this.$el),this.$el.$_vs_onResize=void 0,this.$_sizeObserved=!1)},onResize(e,t,i){this.id===e&&this.applyWidthHeight(t,i)}},render(){return le(this.tag,this.$slots.default())}};B.__file="src/components/DynamicScrollerItem.vue";function Ie(e,t){e.component("".concat(t,"recycle-scroller"),R),e.component("".concat(t,"RecycleScroller"),R),e.component("".concat(t,"dynamic-scroller"),O),e.component("".concat(t,"DynamicScroller"),O),e.component("".concat(t,"dynamic-scroller-item"),B),e.component("".concat(t,"DynamicScrollerItem"),B)}var Ve={version:"2.0.0-beta.8",install:function(t,i){var s=Object.assign({},{installComponents:!0,componentsPrefix:""},i);for(var r in s)typeof s[r]<"u"&&(G[r]=s[r]);s.installComponents&&Ie(t,s.componentsPrefix)}};export{Ve as p};
