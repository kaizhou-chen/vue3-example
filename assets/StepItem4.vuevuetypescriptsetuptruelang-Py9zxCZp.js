import{u as I,d as z}from"./marketingApi-COwuQjUE.js";import{r as y,d as N,c as b,a as w,o as k,I as v,X as m,e as h,w as x,Z as F,u as c,Y as B,K as S}from"./index-D6tOstyB.js";const V=()=>{const u=y({filename:"",fileSize:0,loaded:0}),d=5*1024*1024;function i(e){u.value={filename:e.name,fileSize:e.size,loaded:0};const n=_(e);for(const t of n)p(t,n.length)}function _(e){const n=[];let t=0;for(;t<e.size;)n.push({chunk:e.slice(t,t+d)}),t+=d;return n.map(({chunk:r},o)=>({filename:e.name,chunk:r,index:o}))}function p(e,n){const{chunk:t,filename:f,index:r}=e,o=new FormData;o.append("filename",f),o.append("chunk",t),o.append("index",r),o.append("total",n),I(o,g=>{u.value.loaded+=g})}return{fileInfo:u,uploadFile:i}},D={style:{width:"600px"}},P={key:0},j={key:0,style:{"margin-top":"20px"}},L=N({__name:"StepItem4",setup(u,{expose:d}){const{fileInfo:i,uploadFile:_}=V(),p=y(),e=y(0),n=b(()=>{const{loaded:a,fileSize:l}=i.value;return o(a,l)});function t(){p.value.click()}function f(a){const l=a.target.files[0];_(l)}function r(){z(i.value.filename,(a,l)=>{e.value=o(a,l)})}function o(a,l){let s=a/l*100;return s=Math.min(s,100),parseInt(String(s))}function g(){return new Promise((a,l)=>{a(!0)})}return d({validate:g}),(a,l)=>{const s=w("el-button"),C=w("el-progress");return k(),v("div",D,[m("div",null,[h(s,{type:"primary",onClick:t},{default:x(()=>[F("上传文件")]),_:1}),m("input",{ref_key:"fileInput",ref:p,type:"file",onChange:f,style:{display:"none"}},null,544),c(i).filename!==""?(k(),v("div",P,[m("h3",null,B(c(i).filename),1),h(C,{"text-inside":!0,"stroke-width":26,percentage:c(n)},null,8,["percentage"])])):S("",!0)]),c(n)>=100?(k(),v("div",j,[h(s,{type:"primary",onClick:r},{default:x(()=>[F("下载文件")]),_:1}),m("div",null,[h(C,{type:"dashboard",percentage:c(e)},null,8,["percentage"])])])):S("",!0)])}}});export{L as _};
